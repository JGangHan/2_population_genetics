### 1. 基于单样本 gvcf.gz 文件，合并为群体 vcf.gz 文件（joint call）

#### 1.1 传统方式



#### 1.2 赛乐服务器方式
```
# 1. 检索全部样本，并保存至 jointcall.list 文件中
find /workspace/public/zongzhan/qmrb_sheep/snp_calling -type f -name "*.gvcf.gz" > jointcall.list
# 样本数量
wc -l test.list 
# jointcall.list 内容如下：
# /workspace/public/zongzhan/qmrb_sheep/snp_calling/G31.gvcf.gz
# /workspace/public/zongzhan/qmrb_sheep/snp_calling/G33.gvcf.gz
# ..................
# /workspace/public/zongzhan/qmrb_sheep/snp_calling/G28.gvcf.gz

# 2. 若通过 Windows 手动输入 jointcall.list 文件，可能需要额外转为 unix 格式
dos2unix jointcall.list

# 3. joint call
# -o 输出 gvcf.gz 文件，-g 输出 vcf.gz 文件
# 内存允许尽量同时保存  gvcf.gz 和 vcf.gz 文件，vcf.gz 可直接用于下游分析，如果需增添群体样本，则需要 gvcf.gz 文件
/data/saile/cmd/slmgvcf_gpu  $(cat jointcall.list) -o /workspace/public/zongzhan/qmrb_sheep/jointcall/qmrb_50sheep.gvcf.gz -g /workspace/public/zongzhan/qmrb_sheep/jointcall/qmrb_50sheep.vcf.gz

# 4. 成功获得 qmrb_50sheep.vcf.gz 和 qmrb_50sheep.gvcf.gz 文件
```

### 2. gvcf 文件 和 vcf 文件区别
**gVCF 文件包含全基因组的变异和非变异信息，适用于多样本联合分析；VCF 文件仅包含变异位点，适用于结果展示和下游分析；vcf 文件基于多个 gvcf 文件产生**  

#### 2.1 gVCF（genomic VCF）文件
**同时记录变异位点外和非变异位点的信息**  
**适用于单样本分析，是多样本联合变异检测（joint genotyping）的前提。**  
**与vcf文件格式类似，详见vcf文件部分**
- 使用 <NON_REF> 占位符描述参考等位基因以外的所有潜在变异；
- 非变异区域会被压缩成一个“区间”表示，称为 reference blocks；
- 每个位点（或区间）都有一个质量分数，说明其为“非变异”的可信度。
```
#1. 头部文件内容

##fileformat=VCFv4.2
##reference=GRCh38
##INFO=<ID=END,Number=1,Type=Integer,Description="End position of the reference block">
##FORMAT=<ID=GT,Number=1,Type=String,Description="Genotype">
##FORMAT=<ID=DP,Number=1,Type=Integer,Description="Read Depth">
##FORMAT=<ID=GQ,Number=1,Type=Integer,Description="Genotype Quality">
##FORMAT=<ID=MIN_DP,Number=1,Type=Integer,Description="Minimum DP observed within the reference block">
##FORMAT=<ID=PL,Number=G,Type=Integer,Description="Phred-scaled genotype likelihoods">
#CHROM  POS     ID      REF     ALT         QUAL    FILTER  INFO            FORMAT                  Sample1               Sample2               Sample3

# 2. 数据部分内容

chr1    123456  .       A       G,<NON_REF>    50      PASS    .               GT:DP:GQ:PL           0/1:100:50:100,0,200    1/1:90:60:300,60,0     0/0:80:99:0,120,1800
chr1    123457  .       C       <NON_REF>      .       .       END=123788      GT:DP:GQ:MIN_DP:PL    0/0:95:99:85:0,120,1800 0/0:90:99:90:0,120,1800 0/0:80:99:80:0,120,1800
chr1    123789  .       T       C,<NON_REF>    99      PASS    .               GT:DP:GQ:PL           0/0:85:99:0,120,1800    0/1:80:90:100,0,100     0/1:75:85:100,0,200
chr2    234000  .       A       <NON_REF>      .       .       END=234566      GT:DP:GQ:MIN_DP:PL    0/0:70:99:65:0,120,1800 0/0:65:99:60:0,120,1800 0/0:75:99:70:0,120,1800
chr2    234567  .       G       A,<NON_REF>    70      PASS    .               GT:DP:GQ:PL           1/1:90:80:300,80,0      0/1:85:85:100,0,100     0/1:95:87:100,0,100
```
- ALT = G,<NON_REF>：这个位置有替代等位基因 G，并记录 <NON_REF>（为 joint genotyping 准备）；
- <NON_REF> 表示“我们看过这里，没有发现任何变异”；
- END=123788 是这个区间的结束位置；
- GT=0/0 表示基因型是纯合参考
- 0/1:100:50:100,0,200  1/1:90:60:300,60,0  0/0:80:99:0,120,1800 表示三个样本对应的三种基因型**基因型似然得分**，值越小可能性越高
- 0/1:100:50:100,0,200：“100,0,200”从左到右依次为100 0 200，分别代表纯合参考0/0、杂合0/1、纯合突变1/1，中间为0，所以该样本为杂合0/1
- 1/1:90:60:300,60,0：最右侧为0，该样本为纯合突变1/1

#### 2.2 vcf（Variant Call Format）文件
**用于存储基因组变异信息的标准文件格式，由头部（Header）和变异数据（Body）两部分组成**    

```
# 1. 头部信息

##fileformat=VCFv4.2
##reference=GRCh38
##contig=<ID=1,length=248956422>
##INFO=<ID=DP,Number=1,Type=Integer,Description="Total Depth">
##FORMAT=<ID=GT,Number=1,Type=String,Description="Genotype">

#CHROM  POS     ID      REF     ALT     QUAL    FILTER  INFO    FORMAT  sample1 sample2
```
- CHROM：染色体名称或序列名称（例如 1, X, chr2 等）。
- POS：变异的位置，指示变异在染色体上的起始位置。
- ID：变异的标识符，通常是 dbSNP 的 rsID，如 rs12345。如果没有标识符，则用 . 表示。
- REF：参考基因组中该位置的碱基或碱基序列。
- ALT：变异的碱基或碱基序列，可能是单一的替代碱基，也可以是多种碱基的组合。
- QUAL：质量值，表示变异的置信度。较高的值通常表示较高的可信度。
- FILTER：该变异是否通过过滤。常见的值是 PASS，表示该变异通过了质量控制；其他值（如 LowQual）表示未通过过滤。
- INFO：变异的其他信息，通常是以键值对形式表示，例如变异深度（DP）、变异类型（Type）等。
- FORMAT：指定样本基因型信息的格式。通常包含诸如基因型（GT）、深度（DP）、基因型质量（GQ）等字段。
- 样本列（sample1, sample2, ...）：每个样本的基因型信息。基因型通常以 0/0（纯合参考）、0/1（杂合）、1/1（纯合变异）等表示，同时冒号后显示基因频率（1/1:20,80），多个样本之间由制表符分隔。



```
# 2. 数据部分:列出每个变异的具体信息。每一行对应一个变异，列按照头部的列标题顺序排列。

##fileformat=VCFv4.2
##source=MyVariantCaller
##INFO=<ID=DP,Number=1,Type=Integer,Description="Total Depth">
##FORMAT=<ID=GT,Number=1,Type=String,Description="Genotype">
##FORMAT=<ID=AD,Number=R,Type=Integer,Description="Allelic depths for the ref and alt alleles">
#CHROM  POS     ID      REF     ALT     QUAL    FILTER  INFO        FORMAT          Sample1         Sample2         Sample3
chr1    123456  .       A       G       50      PASS    DP=100      GT:AD           0/1:60,40      1/1:20,80      0/0:90,10
chr1    123789  .       T       C       99      PASS    DP=80       GT:AD           0/0:70,10      0/1:40,40      0/1:50,30
chr2    234567  .       G       A       70      PASS    DP=95       GT:AD           1/1:15,80      0/1:50,45      0/1:60,35
```














































































